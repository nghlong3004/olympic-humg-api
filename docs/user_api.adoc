== User API

'''

=== Introduction

Module `User` chịu trách nhiệm:

* Lấy thông tin người dùng hiện tại (`GET /user/me`).
* Cập nhật thông tin người dùng hiện tại (`PATCH /user/me`).
* Lấy thông tin chi tiết một user theo ID (`GET /user/{userId}`).
* Tìm kiếm user theo tên, có phân trang (`GET /user`).

'''

=== UserResponse Data Type

Các field có giá trị `null` sẽ bị ẩn khỏi JSON.

[cols="2,2,6",options="header"]
|===
| Trường         | Kiểu     | Ghi chú

| `id`           | number   | ID user
| `firstName`    | string   | Tên
| `lastName`     | string   | Họ
| `email`        | email    | Email
| `gender`       | enum     | `MALE`, `FEMALE`, `OTHER`
| `birthday`     | date     | Ngày sinh
| `role`         | enum     | `STUDENT`, `TEACHER`, `ADMIN`
| `phone`        | string   | SĐT (Ẩn nếu null)
| `universityName`| string  | Tên trường (Ẩn nếu null)
| `facultyName`  | string   | Tên khoa (Ẩn nếu null)
| `avatarUrl`    | string   | Link avatar (Ẩn nếu null)
| `created`      | datetime | Thời điểm tạo
| `updated`      | datetime | Thời điểm cập nhật
|===

'''

=== Get Current User

==== GET /user/me

Lấy thông tin user dựa trên session hiện tại.

*Request*

[source]
----
GET /api/user/me
----

Browser gửi cookie tự động:

[source]
----
Cookie: JSESSIONID=abc123xyz;
----

*Response*

_200 OK_

[source,json]
----
{
  "id": 42,
  "firstName": "Long",
  "lastName": "Nguyen",
  "email": "long@example.com",
  "gender": "MALE",
  "birthday": "2004-03-30",
  "role": "STUDENT",
  "universityName": "HUMG",
  "facultyName": "Control Engineering",
  "phone": "0987123456",
  "avatarUrl": "https://cdn.example.com/avatar/default.png",
  "created": "2025-02-10T12:30:00",
  "updated": "2025-02-10T12:30:00"
}
----

_401 Unauthorized_

[source,json]
----
{
  "timestamp": "2025-02-10T12:30:00",
  "status": 401,
  "message": "Not authenticated"
}
----

'''

=== Update Current User

==== PATCH /user/me

Cập nhật profile của user đang đăng nhập.
Không cho phép cập nhật: `email`, `role`, `isActive` qua API này.

*Request*

[source]
----
PATCH /api/user/me
----

_Headers_

[source]
----
Content-Type: application/json
Cookie: JSESSIONID=abc123xyz;
----

_Body_

[source,json]
----
{
  "firstName": "Long",
  "lastName": "Nguyen",
  "phone": "0912345678",
  "universityName": "HUMG",
  "facultyName": "Information Technology",
  "avatarUrl": "https://cdn.example.com/avatar/long.png"
}
----

_Các trường được phép cập nhật:_

[cols="2,2,3,5",options="header"]
|===
| Trường          | Kiểu   | Bắt buộc | Ghi chú

| `firstName`     | string | no       | Tên
| `lastName`      | string | no       | Họ
| `phone`         | string | no       | Số điện thoại
| `universityName`| string | no       | Tên trường
| `facultyName`   | string | no       | Tên khoa
| `avatarUrl`     | string | no       | Link ảnh đại diện
|===

*Response*

_200 OK_

[source,json]
----
{
  "message": "Update success",
  "user": {
    "id": 42,
    "firstName": "Long",
    "lastName": "Nguyen",
    "email": "long@example.com",
    "gender": "MALE",
    "birthday": "2004-03-30",
    "role": "STUDENT",
    "universityName": "HUMG",
    "facultyName": "Information Technology",
    "phone": "0912345678",
    "avatarUrl": "https://cdn.example.com/avatar/long.png",
    "created": "2025-02-10T12:30:00",
    "updated": "2025-02-11T09:00:00"
  }
}
----

_400 Bad Request_

[source,json]
----
{
  "timestamp": "2025-02-11T09:00:00",
  "status": 400,
  "message": "Validation failed",
  "details": {
    "firstName": "must not be blank",
    "phone": "invalid phone number format"
  }
}
----

_401 Unauthorized_

[source,json]
----
{
  "timestamp": "2025-02-11T09:00:00",
  "status": 401,
  "message": "Not authenticated"
}
----

'''

=== Get User by ID

==== GET /user/{userId}

Lấy thông tin một user khác (Public profile).

*Request*

[source]
----
GET /api/user/42
----

*Response*

_200 OK_

[source,json]
----
{
  "id": 42,
  "firstName": "Long",
  "lastName": "Nguyen",
  "email": "long@example.com",
  "gender": "MALE",
  "birthday": "2004-03-30",
  "role": "STUDENT",
  "universityName": "HUMG",
  "facultyName": "Control Engineering",
  "phone": "0987123456",
  "avatarUrl": "https://cdn.example.com/avatar/default.png",
  "created": "2025-02-10T12:30:00",
  "updated": "2025-02-10T12:30:00"
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-02-10T12:30:00",
  "status": 404,
  "message": "User not found"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-10T12:30:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Search User

==== GET /user

Tìm kiếm user theo `firstName` + `lastName`, có phân trang.

*Request*

[source]
----
GET /api/user?keyword=long&page=0&size=10
----

_Query params_

[cols="2,2,3,5",options="header"]
|===
| Tham số | Kiểu   | Bắt buộc | Ghi chú

| `keyword` | string | no       | Chuỗi tìm kiếm theo tên
| `page`    | number | no       | Mặc định = 0
| `size`    | number | no       | Mặc định = 20
| `role`    | enum   | no       | Filter theo role
|===

*Response*

_200 OK_

[source,json]
----
{
  "content": [
    {
      "id": 42,
      "firstName": "Long",
      "lastName": "Nguyen",
      "email": "long@example.com",
      "gender": "MALE",
      "birthday": "2004-03-30",
      "role": "STUDENT",
      "universityName": "HUMG",
      "facultyName": "Control Engineering",
      "phone": "0987123456",
      "avatarUrl": "https://cdn.example.com/avatar/default.png",
      "created": "2025-02-10T12:30:00",
      "updated": "2025-02-10T12:30:00"
    }
  ],
  "page": 0,
  "size": 10,
  "totalElements": 1,
  "totalPages": 1
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-10T12:35:00",
  "status": 403,
  "message": "Access denied"
}
----