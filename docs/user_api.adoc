== User API

=== Introduction

Module `User` chịu trách nhiệm:

* Lấy thông tin người dùng hiện tại (`GET /user/me`)
* Cập nhật thông tin người dùng hiện tại (`PATCH /user/me`)
* Lấy thông tin chi tiết một user theo ID (`GET /user/{userId}`)
* Tìm kiếm user theo tên, có phân trang (`GET /user`)

Tất cả API trong module này yêu cầu người dùng đã đăng nhập bằng session-cookie `JSESSIONID`.

=== UserResponse Data Type

[cols="2,2,6",options="header"]
|===
| Trường
| Kiểu
| Ghi chú

| `id` | number | ID user
| `firstName` | string | Tên
| `lastName` | string | Họ
| `email` | email | Email duy nhất
| `gender` | enum | `MALE`, `FEMALE`, `OTHER`
| `birthday` | date | Ngày sinh
| `role` | enum | `STUDENT`, `TEACHER`, `ADMIN`
| `phone` | string | SĐT, có thể null
| `universityName` | string | Tên trường
| `facultyName` | string | Tên khoa
| `avatarUrl` | string | Link avatar
| `created` | datetime | Thời điểm tạo
| `updated` | datetime | Thời điểm cập nhật
|===

=== Get Current User

==== GET /user/me

Lấy thông tin user dựa trên session hiện tại.

*Request*

[source]
----
GET /api/user/me
----

Browser gửi cookie tự động:

[source]
----
Cookie: JSESSIONID=abc123xyz;
----

*Response*

_200 OK_

[source,json]
----
{
  "id": 42,
  "firstName": "Long",
  "lastName": "Nguyen",
  "email": "long@example.com",
  "gender": "MALE",
  "birthday": "2004-03-30",
  "role": "STUDENT",
  "universityName": "HUMG",
  "facultyName": "Control Engineering",
  "phone": "0987123456",
  "avatarUrl": "https://cdn.example.com/avatar/default.png",
  "created": "2025-02-10T12:30:00",
  "updated": "2025-02-10T12:30:00"
}
----

_401 Unauthorized_

[source,json]
----
{
  "message": "Not authenticated"
}
----

=== Update Current User

==== PATCH /user/me

Cập nhật profile của user đang đăng nhập.

*Request*

[source]
----
PATCH /api/user/me
----

_Headers_

[source]
----
Content-Type: application/json
Cookie: JSESSIONID=abc123xyz;
----

_Body_

[source,json]
----
{
  "firstName": "Long",
  "lastName": "Nguyen",
  "phone": "0912345678",
  "universityName": "HUMG",
  "facultyName": "Information Technology",
  "avatarUrl": "https://cdn.example.com/avatar/long.png"
}
----

Không cho phép cập nhật qua API này:

* email
* role
* is_active

*Response*

_200 OK_

[source,json]
----
{
  "message": "Update success",
  "user": {
    "id": 42,
    "firstName": "Long",
    "lastName": "Nguyen",
    "email": "long@example.com",
    "gender": "MALE",
    "birthday": "2004-03-30",
    "role": "STUDENT",
    "universityName": "HUMG",
    "facultyName": "Information Technology",
    "phone": "0912345678",
    "avatarUrl": "https://cdn.example.com/avatar/long.png",
    "created": "2025-02-10T12:30:00",
    "updated": "2025-02-11T09:00:00"
  }
}
----

_400 Bad Request_

[source,json]
----
{
  "message": "Invalid input",
  "error": [
    "firstName must not be blank",
    "phone must be a valid phone number"
  ]
}
----

_401 Unauthorized_

[source,json]
----
{
  "message": "Not authenticated"
}
----

=== Get User by ID

==== GET /user/{userId}

Lấy thông tin một user khác.

*Request*

[source]
----
GET /api/user/42
----

*Response*

_200 OK_

[source,json]
----
{
  "id": 42,
  "firstName": "Long",
  "lastName": "Nguyen",
  "email": "long@example.com",
  "gender": "MALE",
  "birthday": "2004-03-30",
  "role": "STUDENT",
  "universityName": "HUMG",
  "facultyName": "Control Engineering",
  "phone": "0987123456",
  "avatarUrl": "https://cdn.example.com/avatar/default.png",
  "created": "2025-02-10T12:30:00",
  "updated": "2025-02-10T12:30:00"
}
----

404 Not Found

[source,json]
----
{
  "message": "User not found"
}
----

401 Unauthorized

[source,json]
----
{
  "message": "Access denied"
}
----

=== Search User

==== GET /user

Tìm kiếm user theo `firstName` + `lastName`, có phân trang.

*Request*

[source]
----
GET /api/user?keyword=long&page=0&size=10
----

_Query params_

[cols="2,2,3,5",options="header"]
|===
| Tham số | Kiểu | Bắt buộc | Ghi chú

| `keyword` | string | no | Chuỗi để tìm kiếm theo tên
| `page` | number | no | Mặc định = 0
| `size` | number | no | Mặc định = 20
| `role` | enum | no | Filter theo role
|===

*Response*

200 OK

[source,json]
----
{
  "content": [
    {
      "id": 42,
      "firstName": "Long",
      "lastName": "Nguyen",
      "email": "long@example.com",
      "gender": "MALE",
      "birthday": "2004-03-30",
      "role": "STUDENT",
      "universityName": "HUMG",
      "facultyName": "Control Engineering",
      "phone": "0987123456",
      "avatarUrl": "https://cdn.example.com/avatar/default.png",
      "created": "2025-02-10T12:30:00",
      "updated": "2025-02-10T12:30:00"
    }
  ],
  "page": 0,
  "size": 10,
  "totalElements": 1,
  "totalPages": 1
}
----

401 Unauthorized

[source,json]
----
{
  "message": "Access denied"
}
----