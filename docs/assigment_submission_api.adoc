== Assignment Submission API

'''

=== Introduction

Module `Assignment Submission` chịu trách nhiệm:

* Ghi nhận việc sinh viên nộp bài cho một `assignment`.
* Quản lý trạng thái chấm điểm của bài nộp.
* Cho phép giảng viên xem danh sách bài nộp, cập nhật điểm.

'''

=== AssignmentSubmissionResponse Data Type

Các field có giá trị `null` sẽ bị ẩn khỏi JSON.

[cols="2,2,6",options="header"]
|===
| Trường        | Kiểu     | Ghi chú

| `id`          | number   | ID submission
| `assignmentId`| number   | ID assignment
| `studentId`   | number   | ID sinh viên
| `status`      | enum     | `PENDING`, `SUBMITTED`, `GRADED`
| `scoreTotal`  | number   | Tổng điểm
| `submitted`   | datetime | Thời điểm nộp bài
| `graded`      | datetime | Thời điểm chấm xong
|===

'''

=== Create or Submit Assignment

==== POST /assignment/{assignmentId}/submission

Sinh viên nộp bài cho một assignment.

*Request*

_Method_

[source,subs="attributes+"]
----
POST {api-base}/assignment/5/submission
----

_Headers_

[source]
----
Content-Type: application/json
Authorization: Bearer <accessToken>
----

_Body_

[source,json]
----
{
  "status": "SUBMITTED"
}
----

*Response*

_201 Created_

[source,json]
----
{
  "id": 1000,
  "assignmentId": 5,
  "studentId": 99,
  "status": "SUBMITTED",
  "submitted": "2025-03-02T20:15:00"
}
----

_400 Bad Request_

[source,json]
----
{
  "timestamp": "2025-03-02T20:16:00",
  "status": 400,
  "message": "Invalid status transition"
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-03-02T20:16:00",
  "status": 404,
  "message": "Assignment not found"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-03-02T20:16:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Get My Submission for Assignment

==== GET /assignment/{assignmentId}/submission/me

Sinh viên xem thông tin bài nộp của chính mình cho assignment đó.

*Request*

[source,subs="attributes+"]
----
GET {api-base}/assignment/5/submission/me
----

_Headers_

[source]
----
Authorization: Bearer <accessToken>
----

*Response*

_200 OK_

[source,json]
----
{
  "id": 1000,
  "assignmentId": 5,
  "studentId": 99,
  "status": "GRADED",
  "scoreTotal": 8,
  "submitted": "2025-03-02T20:15:00",
  "graded": "2025-03-03T10:00:00"
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-03-02T20:20:00",
  "status": 404,
  "message": "Submission not found"
}
----

_401 Unauthorized_

[source,json]
----
{
  "timestamp": "2025-03-02T20:20:00",
  "status": 401,
  "message": "Not authenticated"
}
----

'''

=== Get Submissions of Assignment

==== GET /assignment/{assignmentId}/submission

Giảng viên hoặc admin xem danh sách bài nộp cho một assignment.

*Request*

[source,subs="attributes+"]
----
GET {api-base}/assignment/5/submission?page=0&size=20&status=SUBMITTED
----

_Query params_

[cols="2,2,3,5",options="header"]
|===
| Tham số  | Kiểu   | Bắt buộc | Ghi chú

| `page`   | number | no       | Mặc định = 0
| `size`   | number | no       | Mặc định = 20
| `status` | enum   | no       | Filter theo `PENDING` / `SUBMITTED` / `GRADED`
|===

*Response*

_200 OK_

[source,json]
----
{
  "content": [
    {
      "id": 1000,
      "assignmentId": 5,
      "studentId": 99,
      "status": "SUBMITTED",
      "submitted": "2025-03-02T20:15:00"
    }
  ],
  "page": 0,
  "size": 20,
  "totalElements": 1,
  "totalPages": 1
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-03-02T20:25:00",
  "status": 404,
  "message": "Assignment not found"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-03-02T20:25:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Grade Submission

==== PATCH /assignment/submission/{submissionId}

Giảng viên/ADMIN chấm bài: cập nhật `scoreTotal` và trạng thái `status = GRADED`.

*Request*

[source,subs="attributes+"]
----
PATCH {api-base}/assignment/submission/1000
----

_Headers_

[source]
----
Content-Type: application/json
Authorization: Bearer <accessToken>
----

_Body_

[source,json]
----
{
  "scoreTotal": 8,
  "status": "GRADED"
}
----

*Response*

_200 OK_

[source,json]
----
{
  "message": "Update success",
  "submission": {
    "id": 1000,
    "assignmentId": 5,
    "studentId": 99,
    "status": "GRADED",
    "scoreTotal": 8,
    "submitted": "2025-03-02T20:15:00",
    "graded": "2025-03-03T10:00:00"
  }
}
----

_400 Bad Request_

[source,json]
----
{
  "timestamp": "2025-03-03T10:01:00",
  "status": 400,
  "message": "Score cannot be negative"
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-03-03T10:01:00",
  "status": 404,
  "message": "Submission not found"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-03-03T10:01:00",
  "status": 403,
  "message": "Access denied"
}
----
