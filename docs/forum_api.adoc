== Forum API

'''

=== Introduction

Module `Forum` chịu trách nhiệm:

* Tạo thread thảo luận / đặt câu hỏi / thông báo.
* Trả về danh sách thread (có phân trang, lọc theo type, keyword, owner).
* Quản lý các post (reply) trong thread.

'''

=== ThreadResponse Data Type

Các field có giá trị `null` sẽ bị ẩn khỏi JSON.

[cols="2,2,6",options="header"]
|===
| Trường         | Kiểu     | Ghi chú

| `id`           | number   | ID thread
| `title`        | string   | Tiêu đề
| `content`      | string   | Nội dung chính
| `type`         | enum     | `DISCUSSION`, `QUESTION`, `ANNOUNCEMENT`
| `isPinned`     | boolean  | Có đang được ghim hay không
| `isActive`     | boolean  | `true` nếu còn hiệu lực
| `ownerId`      | number   | ID người tạo thread
| `created`      | datetime | Thời điểm tạo
| `updated`      | datetime | Thời điểm cập nhật gần nhất
|===

=== PostResponse Data Type

Các field có giá trị `null` sẽ bị ẩn khỏi JSON.

[cols="2,2,6",options="header"]
|===
| Trường         | Kiểu     | Ghi chú

| `id`           | number   | ID post
| `threadId`     | number   | ID thread chứa post này
| `ownerId`      | number   | ID người viết post
| `content`      | string   | Nội dung reply
| `isActive`     | boolean  | `true` nếu còn hiệu lực
| `created`      | datetime | Thời điểm tạo
| `updated`      | datetime | Thời điểm cập nhật gần nhất
|===

'''

=== Get Thread List

==== GET /forum/thread

Lấy danh sách thread, có phân trang và filter cơ bản.

*Request*

_Method_

[source,subs="attributes+"]
----
GET {api-base}/forum/thread
----

_Query params_

[cols="2,2,3,5",options="header"]
|===
| Tham số   | Kiểu    | Bắt buộc | Ghi chú

| `page`    | number  | no       | Mặc định = 0
| `size`    | number  | no       | Mặc định = 20
| `type`    | enum    | no       | `DISCUSSION` / `QUESTION` / `ANNOUNCEMENT`
| `keyword` | string  | no       | Tìm trong `title` và `content`
| `ownerId` | number  | no       | Filter theo người tạo thread
| `pinned`  | boolean | no       | Nếu `true` chỉ lấy thread đang ghim
|===

_Example_

[source,subs="attributes+"]
----
GET {api-base}/forum/thread?page=0&size=10
GET {api-base}/forum/thread?type=QUESTION&keyword=limit
----

*Response*

_200 OK_

[source,json]
----
{
  "content": [
    {
      "id": 1,
      "title": "Thảo luận bài tập giới hạn",
      "content": "Mọi người cho mình hỏi về bài tập giới hạn này...",
      "type": "QUESTION",
      "isPinned": false,
      "isActive": true,
      "ownerId": 42,
      "created": "2025-02-10T12:30:00",
      "updated": "2025-02-10T12:30:00"
    }
  ],
  "page": 0,
  "size": 10,
  "totalElements": 1,
  "totalPages": 1
}
----

_401 Unauthorized_

[source,json]
----
{
  "timestamp": "2025-02-10T12:35:00",
  "status": 401,
  "message": "Not authenticated"
}
----

'''

=== Get Thread Detail

==== GET /forum/thread/{threadId}

Lấy chi tiết 1 thread.

*Request*

[source,subs="attributes+"]
----
GET {api-base}/forum/thread/1
----

*Response*

_200 OK_

[source,json]
----
{
  "id": 1,
  "title": "Thảo luận bài tập giới hạn",
  "content": "Mọi người cho mình hỏi về bài tập giới hạn này...",
  "type": "QUESTION",
  "isPinned": false,
  "isActive": true,
  "ownerId": 42,
  "created": "2025-02-10T12:30:00",
  "updated": "2025-02-10T12:30:00"
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-02-10T12:40:00",
  "status": 404,
  "message": "Thread not found"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-10T12:40:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Create Thread

==== POST /forum/thread

Tạo mới một thread.

*Request*

_Method_

[source,subs="attributes+"]
----
POST {api-base}/forum/thread
----

_Headers_

[source]
----
Content-Type: application/json
Authorization: Bearer <accessToken>
----

_Body_

[source,json]
----
{
  "title": "Thảo luận bài tập giới hạn",
  "content": "Mọi người cho mình hỏi về bài tập sau...",
  "type": "QUESTION"
}
----

_Data Constraints_

[cols="2,2,3,5",options="header"]
|===
| Trường   | Kiểu           | Bắt buộc | Ghi chú

| `title`  | string (1..55) | yes      | Tiêu đề thread
| `content`| string         | yes      | Nội dung thread
| `type`   | enum           | no       | Mặc định `DISCUSSION`
|===

*Response*

_201 Created_

[source,json]
----
{
  "id": 1,
  "title": "Thảo luận bài tập giới hạn",
  "content": "Mọi người cho mình hỏi về bài tập sau...",
  "type": "QUESTION",
  "isPinned": false,
  "isActive": true,
  "ownerId": 42,
  "created": "2025-02-10T12:30:00",
  "updated": "2025-02-10T12:30:00"
}
----

_400 Bad Request_

[source,json]
----
{
  "timestamp": "2025-02-10T12:30:00",
  "status": 400,
  "message": "Validation failed"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-10T12:30:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Update Thread

==== PATCH /forum/thread/{threadId}

Cho phép sửa metadata của thread.
Chỉ `owner` hoặc `ADMIN` được sửa.

*Request*

[source,subs="attributes+"]
----
PATCH {api-base}/forum/thread/1
----

_Headers_

[source]
----
Content-Type: application/json
Authorization: Bearer <accessToken>
----

_Body_

[source,json]
----
{
  "title": "Thảo luận bài tập giới hạn (đã cập nhật)",
  "content": "Cập nhật thêm đề bài đầy đủ...",
  "type": "QUESTION",
  "isPinned": true
}
----

*Response*

_200 OK_

[source,json]
----
{
  "message": "Update success",
  "thread": {
    "id": 1,
    "title": "Thảo luận bài tập giới hạn (đã cập nhật)",
    "content": "Cập nhật thêm đề bài đầy đủ...",
    "type": "QUESTION",
    "isPinned": true,
    "isActive": true,
    "ownerId": 42,
    "created": "2025-02-10T12:30:00",
    "updated": "2025-02-11T09:00:00"
  }
}
----

_400 Bad Request_

[source,json]
----
{
  "timestamp": "2025-02-11T09:00:00",
  "status": 400,
  "message": "Validation failed"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-11T09:00:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Delete Thread

==== DELETE /forum/thread/{threadId}

Marks `is_active = false` cho thread.
Các `forum_post` liên quan có thể được giữ nguyên hoặc ẩn, tuỳ logic backend.

*Request*

[source,subs="attributes+"]
----
DELETE {api-base}/forum/thread/1
----

_Headers_

[source]
----
Authorization: Bearer <accessToken>
----

*Response*

_204 No content_

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-02-11T10:00:00",
  "status": 404,
  "message": "Thread not found"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-11T10:00:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Get Posts of Thread

==== GET /forum/thread/{threadId}/post

Lấy danh sách post thuộc một thread, có phân trang.

*Request*

[source,subs="attributes+"]
----
GET {api-base}/forum/thread/1/post?page=0&size=20
----

_Query params_

[cols="2,2,3,5",options="header"]
|===
| Tham số | Kiểu   | Bắt buộc | Ghi chú

| `page`  | number | no       | Mặc định = 0
| `size`  | number | no       | Mặc định = 20
|===

*Response*

_200 OK_

[source,json]
----
{
  "content": [
    {
      "id": 100,
      "threadId": 1,
      "ownerId": 42,
      "content": "Theo mình thì bài này làm như sau...",
      "isActive": true,
      "created": "2025-02-10T13:00:00",
      "updated": "2025-02-10T13:00:00"
    }
  ],
  "page": 0,
  "size": 20,
  "totalElements": 1,
  "totalPages": 1
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-02-10T13:05:00",
  "status": 404,
  "message": "Thread not found"
}
----

'''

=== Create Post in Thread

==== POST /forum/thread/{threadId}/post

Tạo một post (reply) mới trong thread.

*Request*

[source,subs="attributes+"]
----
POST {api-base}/forum/thread/1/post
----

_Headers_

[source]
----
Content-Type: application/json
Authorization: Bearer <accessToken>
----

_Body_

[source,json]
----
{
  "content": "Theo mình thì bài này làm như sau..."
}
----

_Data Constraints_

[cols="2,2,3,5",options="header"]
|===
| Trường   | Kiểu   | Bắt buộc | Ghi chú

| `content`| string | yes      | Nội dung post
|===

*Response*

_201 Created_

_400 Bad Request_

[source,json]
----
{
  "timestamp": "2025-02-10T13:00:00",
  "status": 400,
  "message": "Validation failed"
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-02-10T13:00:00",
  "status": 404,
  "message": "Thread not found"
}
----

_401 Unauthorized_

[source,json]
----
{
  "timestamp": "2025-02-10T13:00:00",
  "status": 401,
  "message": "Not authenticated"
}
----

'''

=== Update Post

==== PATCH /forum/post/{postId}

Chỉ `owner` hoặc `ADMIN` được sửa post.

*Request*

[source,subs="attributes+"]
----
PATCH {api-base}/forum/post/100
----

_Headers_

[source]
----
Content-Type: application/json
Authorization: Bearer <accessToken>
----

_Body_

[source,json]
----
{
  "content": "Mình chỉnh lại lời giải cho rõ hơn..."
}
----

*Response*

_200 OK_

[source,json]
----
{
  "message": "Update success",
  "post": {
    "id": 100,
    "threadId": 1,
    "ownerId": 42,
    "content": "Mình chỉnh lại lời giải cho rõ hơn...",
    "isActive": true,
    "created": "2025-02-10T13:00:00",
    "updated": "2025-02-11T09:10:00"
  }
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-11T09:10:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Delete Post

==== DELETE /forum/post/{postId}

Soft delete: set `is_active = false`.

*Request*

[source,subs="attributes+"]
----
DELETE {api-base}/forum/post/100
----

_Headers_

[source]
----
Authorization: Bearer <accessToken>
----

*Response*

_204 No content_

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-11T10:00:00",
  "status": 403,
  "message": "Access denied"
}
----
