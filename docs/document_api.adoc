== Document API

'''

=== Introduction

Module `Document` chịu trách nhiệm:

* Giảng viên/Admin upload tài liệu.
* Sinh viên xem danh sách tài liệu, xem chi tiết.

'''

=== DocumentResponse Data Type

Các field có giá trị `null` sẽ bị ẩn khỏi JSON.

[cols="2,2,6",options="header"]
|===
| Trường
| Kiểu
| Ghi chú

| `id`           | number   | ID tài liệu
| `title`        | string   | Tiêu đề tài liệu
| `description`  | string   | Mô tả ngắn (Ẩn nếu null)
| `fileUrl`      | string   | URL truy cập file
| `fileType`     | string   | Loại file (`pdf`, `docx`...)
| `fileSize`     | number   | Kích thước file (bytes)
| `subjectName`  | string   | Tên môn/chủ đề (Ẩn nếu null)
| `accessType`   | enum     | `PUBLIC` hoặc `PRIVATE`
| `ownerId`      | number   | ID người upload
| `created`      | datetime | Thời điểm tạo
| `updated`      | datetime | Thời điểm cập nhật gần nhất
|===

'''

=== Upload Document

==== POST /document

Giảng viên/Admin upload một tài liệu mới.
Upload dùng `multipart/form-data`.

*Request*

_Method_

[source,subs="attributes+"]
----
POST {api-base}/document
----

_Headers_

[source]
----
Content-Type: multipart/form-data
Authorization: Bearer <accessToken>
----

_Body_

[cols="2,2,3,5",options="header"]
|===
| Trường        | Kiểu            | Bắt buộc | Ghi chú

| `file`        | file            | yes      | File tài liệu
| `title`       | string (1..50)  | yes      | Tiêu đề tài liệu
| `description` | string (<= 155) | no       | Mô tả ngắn
| `subjectName` | string (<= 30)  | no       | Tên môn/chủ đề
| `accessType`  | enum            | no       | `PUBLIC` (default) / `PRIVATE`
|===

*Response*

_201 Created_

[source,json]
----
{
  "id": 10,
  "title": "Tài liệu ôn tập Toán 1",
  "description": "Tổng hợp công thức và bài tập chương 1",
  "fileUrl": "https://cdn.example.com/documents/10.pdf",
  "fileType": "pdf",
  "fileSize": 123456,
  "subjectName": "Math",
  "accessType": "PUBLIC",
  "ownerId": 42,
  "created": "2025-02-10T12:30:00",
  "updated": "2025-02-10T12:30:00"
}
----

_400 Bad Request_

[source,json]
----
{
  "timestamp": "2025-02-10T12:30:00",
  "status": 400,
  "message": "Validation failed"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-10T12:30:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Get Document List

==== GET /document

Lấy danh sách tài liệu, hỗ trợ phân trang và filter cơ bản.

*Request*

_Method_

[source,subs="attributes+"]
----
GET {api-base}/document
----

_Query params_

[cols="2,2,3,5",options="header"]
|===
| Tham số     | Kiểu   | Bắt buộc | Ghi chú

| `page`      | number | no       | Mặc định = 0
| `size`      | number | no       | Mặc định = 20
| `subject`   | string | no       | Filter theo `subjectName`
| `keyword`   | string | no       | Tìm kiếm trong `title`, `description`
| `ownerId`   | number | no       | Filter theo người sở hữu
| `accessType`| enum   | no       | `PUBLIC` / `PRIVATE`
|===

_Example_

[source,subs="attributes+"]
----
GET {api-base}/document?page=0&size=10
GET {api-base}/document?subject=Math&keyword=on%20tap
----

*Response*

_200 OK_

[source,json]
----
{
  "content": [
    {
      "id": 10,
      "title": "Tài liệu ôn tập Toán 1",
      "description": "Tổng hợp công thức",
      "fileUrl": "https://cdn.example.com/documents/10.pdf",
      "fileType": "pdf",
      "fileSize": 123456,
      "subjectName": "Math",
      "accessType": "PUBLIC",
      "ownerId": 42,
      "created": "2025-02-10T12:30:00",
      "updated": "2025-02-10T12:30:00"
    },
    {
      "id": 11,
      "title": "Slide bài giảng buổi 2",
      "fileUrl": "https://cdn.example.com/documents/11.pptx",
      "fileType": "pptx",
      "fileSize": 500000,
      "subjectName": "Math",
      "accessType": "PUBLIC",
      "ownerId": 42,
      "created": "2025-02-11T08:00:00",
      "updated": "2025-02-11T08:00:00"
    }
  ],
  "page": 0,
  "size": 10,
  "totalElements": 2,
  "totalPages": 1
}
----

_401 Unauthorized_

[source,json]
----
{
  "timestamp": "2025-02-10T12:35:00",
  "status": 401,
  "message": "Not authenticated"
}
----

'''

=== Get Document Detail

==== GET /document/{documentId}

Lấy chi tiết một tài liệu theo `documentId`.

*Request*

[source,subs="attributes+"]
----
GET {api-base}/document/10
----

*Response*

_200 OK_

[source,json]
----
{
  "id": 10,
  "title": "Tài liệu ôn tập Toán 1",
  "description": "Tổng hợp công thức và bài tập chương 1",
  "fileUrl": "https://cdn.example.com/documents/10.pdf",
  "fileType": "pdf",
  "fileSize": 123456,
  "subjectName": "Math",
  "accessType": "PUBLIC",
  "ownerId": 42,
  "created": "2025-02-10T12:30:00",
  "updated": "2025-02-10T12:30:00"
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-02-10T12:40:00",
  "status": 404,
  "message": "Document not found"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-10T12:40:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Update Document Metadata

==== PATCH /document/{documentId}

Allows updating document metadata (without re-uploading the file).
Only the owner (creator) or ADMIN is allowed to edit.

*Request*

[source,subs="attributes+"]
----
PATCH {api-base}/document/10
----

_Headers_

[source]
----
Content-Type: application/json
Authorization: Bearer <accessToken>
----

_Body_

[source,json]
----
{
  "title": "Tài liệu ôn tập Toán 1 - bản cập nhật",
  "description": "Bổ sung thêm ví dụ chương 1",
  "subjectName": "Math",
  "accessType": "PUBLIC"
}
----

_Các trường được phép cập nhật:_

[cols="2,2,3,5",options="header"]
|===
| Trường       | Kiểu            | Bắt buộc | Ghi chú

| `title`      | string (1..55)  | no       | Tiêu đề mới
| `description`| string (<= 155) | no       | Mô tả mới
| `subjectName`| string (<= 30)  | no       | Môn/chủ đề
| `accessType` | enum            | no       | `PUBLIC` / `PRIVATE`
|===

*Response*

_200 OK_

[source,json]
----
{
  "message": "Update success",
  "document": {
    "id": 10,
    "title": "Tài liệu ôn tập Toán 1 - bản cập nhật",
    "description": "Bổ sung thêm ví dụ chương 1",
    "fileUrl": "https://cdn.example.com/documents/10.pdf",
    "fileType": "pdf",
    "fileSize": 123456,
    "subjectName": "Math",
    "accessType": "PUBLIC",
    "ownerId": 42,
    "created": "2025-02-10T12:30:00",
    "updated": "2025-02-11T09:00:00"
  }
}
----

_400 Bad Request_

[source,json]
----
{
  "timestamp": "2025-02-11T09:00:00",
  "status": 400,
  "message": "Validation failed"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-11T09:00:00",
  "status": 403,
  "message": "Access denied"
}
----

'''

=== Delete Document

==== DELETE /document/{documentId}

Soft delete tài liệu: đánh dấu `is_active = false`.
Chỉ `owner` hoặc `ADMIN` được phép xoá.

*Request*

[source,subs="attributes+"]
----
DELETE {api-base}/document/10
----

_Headers_

[source]
----
Authorization: Bearer <accessToken>
----

*Response*

_200 OK_

[source,json]
----
{
  "message": "Delete success"
}
----

_404 Not Found_

[source,json]
----
{
  "timestamp": "2025-02-11T10:00:00",
  "status": 404,
  "message": "Document not found"
}
----

_403 Forbidden_

[source,json]
----
{
  "timestamp": "2025-02-11T10:00:00",
  "status": 403,
  "message": "Access denied"
}
----
